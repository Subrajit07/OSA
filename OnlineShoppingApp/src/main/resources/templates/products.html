<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title th:text="${category}"></title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.5/font/bootstrap-icons.min.css" rel="stylesheet">
<link th:href="@{/css/home.css}" rel="stylesheet">
<style type="text/css">
body,.product-filter{
	background-color: rgb(255, 249, 255);  
}

</style>
</head>
<body>
	<header>
    	<div class="logo">
	  		<img src="/images/eco-shop-logo.jpg" style="height: 40px;"/>ùë¨ùí∏‚Çíùêµ‚Çêùìè‚Çê‚Çêùìá
		</div>
    	<nav>
	   		<a th:href="@{/products/home}">Home</a>
	    	<a th:href="@{/products/{category}(category='FOODS')}"
		       th:classappend="${category.name()} == 'FOODS' ? 'active'">Foods</a>
		    <a th:href="@{/products/{category}(category='VEGETABLES')}"
	       	th:classappend="${category.name()} == 'VEGETABLES' ? 'active'">Vegetables</a>
	    	<a th:href="@{/products/{category}(category='ELECTRONICS')}"
	       	th:classappend="${category.name()} == 'ELECTRONICS' ? 'active'">Electronics</a>
	    	<a th:href="@{/products/{category}(category='CLOTHES')}"
	       	th:classappend="${category.name()} == 'CLOTHES' ? 'active'">Clothes</a>
	    	<a th:href="@{/products/{category}(category='SPORTS')}"
	       	th:classappend="${category.name()} == 'SPORTS' ? 'active'">Sports</a>
	    	<a th:href="@{/products/{category}(category='BOOKS')}"
	       	th:classappend="${category.name()} == 'BOOKS' ? 'active'">Books</a>
	    	<a th:href="@{/products/profile}"><i class="bi bi-person-circle"></i> Profile</a>
		</nav>
  	</header>
  	
  	<div class="product-filter">
     	<div class="search-wrapper">
			 <i class="fas fa-search"></i>
				  <input type="text" id="searchBox" placeholder="Search any products..." th:value="${search}">
	 	</div>
	 	<div class="dropdown-with-icon">
  		 	<i class="bi bi-funnel-fill"></i>
			    <select id="sortBy" th:value="${sortBy}">
			        <option value="id">ID</option>
			        <option value="name">Name</option>
			        <option value="price">Price</option>
			        <option value="brand">Brand</option>
			    </select>
	 	</div>
			 <select id="sortOrder" th:value="${sortByOrder}">
			        <option value="asc">&#x25B2; ASC</option>
			        <option value="desc">&#x25BC; DESC</option>
			 </select>
  	</div>
			
			<div class="products-grid">
			    <div class="product-card" th:each="product : ${specificCategory}">
			  
			       <button class="action-icon edit-icon">‚úèÔ∏è</button>
			         	 
			        <a th:href="@{/products/specificProduct/{id}(id=${product.id})}">
			        	<img th:src="@{/products/image/{productId}/{imageIndex}(productId=${product.id}, imageIndex=0)}"
						     alt="Product Image"
						     class="product-image" />
					</a>
			        <h3 class="product-title" th:text="${product.name}"></h3>
			        <p class="product-description" th:text="${product.description}"></p>
			        <div class="product-price-line">
				        <div class="product-discount" th:text="'-' + ${product.discount}+'%'"></div>
				        <div class="product-price fw-bold fs-4" th:text="'‚Çπ' + ${product.price}"></div>
			     	</div>
			     	<div th:class="'product-stock ' + (${#strings.equalsIgnoreCase(product.stock, 'AVAILABLE') ? 'text-success fw-bold' : 'text-danger fw-bold	'})"
    					 th:text="${product.stock}">
					</div>
			        <button class="buy-button">Buy Now</button>&nbsp;&nbsp;
			        <a class="add-to-cart"><i class="bi bi-cart-plus"></i></a>
			    </div>
			</div>
			
			<div class="custom-pagination" th:if="${totalPage > 0}">
			 <div class="custom-pagination">
			    <!-- Previous button -->
			    <a th:href="@{${category}(page=${currentPage - 1}, pageSize=${pageSize}, search=${search}, sortBy=${sortBy}, sortByOrder=${sortByOrder})}"
			       th:classappend="${currentPage == 0} ? ' disabled'">
			       &laquo; 
			    </a>
			    <!-- Page numbers -->
			    <span th:each="i : ${#numbers.sequence(0, totalPage - 1)}">
			        <a th:href="@{${category}(page=${i}, pageSize=${pageSize}, search=${search}, sortBy=${sortBy}, sortByOrder=${sortByOrder})}"
			           th:classappend="${currentPage == i} ? ' active'">
			            <span th:text="${i + 1}"></span>
			        </a>
			    </span>
			    <!-- Next button -->
			    <a th:href="@{${category}(page=${currentPage + 1}, pageSize=${pageSize}, search=${search}, sortBy=${sortBy}, sortByOrder=${sortByOrder})}"
			       th:classappend="${currentPage + 1 >= totalPage} ? ' disabled'">
			        &raquo;
			    </a>
		 	</div>
		 </div>
		 
		 <button class="fab-add-btn" onclick="openModal()">+</button>
		 
		 <!-- Edit Product Modal -->
		<div id="editProductModal" class="modal">
		    <div class="modal-content">
		        <span class="close" onclick="closeModal()">&times;</span>
		        <h2><i class="bi bi-pencil-square"></i> Edit Product</h2>
		        <form id="editProductForm" method="post" enctype="multipart/form-data">
		            <input type="hidden" id="edit-id" name="id">
		
		            <div class="form-field">
		                <label for="edit-name">Product Name</label>
		                <input type="text" id="edit-name" name="name" required>
		            </div>
		
		            <div class="form-field">
		                <label for="edit-brand">Brand</label>
		                <input type="text" id="edit-brand" name="brand" required>
		            </div>
		
		            <div class="form-field full-width">
		                <label for="edit-description">Description:</label>
		                <textarea id="edit-description" name="description" required></textarea>
		            </div>
		
		            <div class="form-field half-width">
		                <label for="edit-price">Price</label>
		                <div class="input-wrapper-left">
		                	<input type="number" id="edit-price" name="price" step="0.01" required>
		                </div>
		            </div>
		            
		            <div class="form-field">
		                <label for="edit-discount">Discount</label>
		                 <div class="input-wrapper">
		                	<input type="number" id="edit-discount" name="discount" step="0.01">
		            	</div>
		            </div>
		
		            <div class="form-field">
		                <label for="edit-category">Category</label>
		                <select id="edit-category" name="category" required>
		                    <option value="FOODS">Foods</option>
		                    <option value="VEGETABLES">Vegetables</option>
		                    <option value="ELECTRONICS">Electronics</option>
		                    <option value="CLOTHES">Clothes</option>
		                    <option value="SPORTS">Sports</option>
		                    <option value="BOOKS">Books</option>
		                </select>
		            </div>
		
		            <div class="form-field">
		                <label for="edit-stock">Stock</label>
		                <select id="edit-stock" name="stock" required>
		                    <option value="AVAILABLE">Available</option>
		                    <option value="OUT_OF_STOCKS">Out of Stocks</option>
		                </select>
		            </div>
		
		            <div class="form-field full-width">
		                <label for="edit-image">Product Image</label>
		                <input type="file" name="files" multiple>
		            </div>
		
		            <button type="submit" class="submit-button">Update Product</button>
		        </form>
		    </div>
		</div>
		
		<!-- Modal add products-->
		<div id="productModal" class="modal">
	        <div class="modal-content">
	            <span class="close" onclick="closeModal()">&times;</span>
	            <h2><i class="bi bi-cart-plus-fill"></i> New Product</h2>
	            <form th:action="@{/products/save}" method="post" enctype="multipart/form-data">
				    <div class="form-field">
				        <label for="name">Product Name</label>
				        <input type="text" id="name" name="name" required>
				    </div>
				    <div class="form-field">
				        <label for="brand">Brand</label>
				        <input type="text" id="brand" name="brand" required>
				    </div>
				
				    <div class="form-field full-width">
				        <label for="description">Description:</label>
				        <textarea id="description" name="description" required></textarea>
				    </div>
				
				   <div class="form-field half-width">
				        <label for="price">Price</label>
				        <div class="input-wrapper-left">
				            <input type="number" id="price" name="price" step="0.01" required>
				        </div>
				    </div>
				    <div class="form-field">
					    <label for="discount">Discount</label>
					    <div class="input-wrapper">
					        <input type="number" id="discount" name="discount" step="0.01">
					    </div>
					</div>
				
				    <div class="form-field">
				        <label for="category">Category</label>
				        <select id="category" name="category" required>
				            <option value="FOODS">Foods</option>
				            <option value="VEGETABLES">Vegetables</option>
				            <option value="ELECTRONICS">Electronics</option>
				            <option value="CLOTHES">Clothes</option>
				            <option value="SPORTS">Sports</option>
				            <option value="BOOKS">Books</option>
				        </select>
				    </div>
				
				    <div class="form-field">
					    <label for="stock">Stock</label>
					    <select id="stock" name="stock" required>
					        <option value="AVAILABLE">Available</option>
					        <option value="OUT_OF_STOCKS">Out of Stocks</option>
					    </select>
					</div>
					
				    <div class="form-field full-width">
				        <label for="image">Product Image</label>
				        <input type="file" name="files" multiple required>
				    </div>
				
				    <button type="submit" class="submit-button">Save Product</button>
				</form>
	        </div>
	    </div>
	    <div th:if="${removed}" class="alert alert-success toast-success" th:text="${removed}"></div>	
		<div th:if="${successMessage}" class="alert alert-success toast-success">
	    	<span th:text="${successMessage}"></span>
		</div>
		 <div th:if="${removed}" class="alert alert-success toast-success" th:text="${removed}"></div>
<script type="text/javascript">
	function openModal() {
	    document.getElementById('productModal').style.display = 'block';
	}
	
	function closeModal() {
	    document.getElementById('productModal').style.display = 'none';
	    document.getElementById('editProductModal').style.display='none';
	}
	
	setTimeout(() => {
	    const toast = document.querySelector('.toast-success');
	    if(toast) toast.style.display = 'none';
	}, 3000);
	
	function openEditModal(id,name,brand,description,price,discount,category,stock) {
	   	document.getElementById('edit-id').value = id;
	    document.getElementById('edit-name').value = name;
	    document.getElementById('edit-brand').value = brand;
	    document.getElementById('edit-description').value = description;
	    document.getElementById('edit-price').value = price;
	    document.getElementById('edit-discount').value = discount;
	    document.getElementById('edit-category').value = category;
	    document.getElementById('edit-stock').value = stock;

	    document.getElementById('editProductForm').action = `/products/edit/${id}`; 

	    document.getElementById('editProductModal').style.display = 'block';
	}
</script>
</body>
</html>